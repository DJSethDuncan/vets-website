# based on https://github.com/nodejs/docker-node/blob/master/4.7/slim/Dockerfile

FROM public.ecr.aws/bitnami/node:14.15.5

RUN mkdir -p /website/vets-website
WORKDIR /website/vets-website

COPY . .
# setting up vets-website
RUN yarn config set "strict-ssl" false
RUN npm config set strict-ssl false
RUN yarn install
RUN yarn build --buildtype=vagovdev

WORKDIR /website

RUN git clone --depth 1 https://github.com/department-of-veterans-affairs/vagov-content
RUN git clone --depth 1 https://github.com/department-of-veterans-affairs/vets-json-schema
RUN git clone --depth 1 https://github.com/department-of-veterans-affairs/veteran-facing-services-tools

EXPOSE 3002
EXPOSE 3001
EXPOSE 3000

CMD ["/bin/bash", "-c", "cd /website/vets-website && yarn watch"]
